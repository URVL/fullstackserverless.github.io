(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{155:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return i})),t.d(n,"metadata",(function(){return s})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return p}));var r=t(1),a=t(9),o=(t(0),t(174)),i={id:"auth1-02",title:"Authentication",sidebar_label:"Part II"},s={id:"auth1-02",title:"Authentication",description:"Firstly, the standard UI from Amplify does not always meet customer UX requirements",source:"@site/docs/auth1.02.md",permalink:"/docs/auth1-02",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/auth1.02.md",sidebar_label:"Part II",sidebar:"someSidebar",previous:{title:"Authentication",permalink:"/docs/auth1-01"},next:{title:"AWS Amplify",permalink:"/docs/amplify-00"}},c=[{value:"UI Kit",id:"ui-kit",children:[]},{value:"Add navigation",id:"add-navigation",children:[]},{value:"react-native-keychain",id:"react-native-keychain",children:[]},{value:"Constants",id:"constants",children:[]},{value:"AppNavigator",id:"appnavigator",children:[]},{value:"Hello screen",id:"hello-screen",children:[]},{value:"SignUp screen",id:"signup-screen",children:[]},{value:"ConfirmSignUp screen",id:"confirmsignup-screen",children:[]},{value:"ResendSignUp",id:"resendsignup",children:[]},{value:"User screen",id:"user-screen",children:[]},{value:"SignIn screen",id:"signin-screen",children:[]},{value:"Forgot password screen",id:"forgot-password-screen",children:[]},{value:"Forgot Password Submit",id:"forgot-password-submit",children:[]},{value:"Linking screens",id:"linking-screens",children:[]},{value:"Udpate AppNavigator",id:"udpate-appnavigator",children:[]},{value:"Clean Up",id:"clean-up",children:[]},{value:"Debug",id:"debug",children:[]},{value:"Done \u2705",id:"done-",children:[]}],l={rightToc:c};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Firstly, the standard UI from Amplify does not always meet customer UX requirements"),Object(o.b)("p",null,"Secondly, in the  ","[official documentation]"," of Amplify (",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://aws-amplify.github.io/docs/js/react#note-on-jwt-storage"}),"https://aws-amplify.github.io/docs/js/react#note-on-jwt-storage"),") it is stated that:"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Data is stored unencrypted when using standard storage adapters (localStorage in the browser and AsyncStorage on React Native). Amplify gives you the option to use your own storage object to persist data. With this, you could write a thin wrapper around libraries like:\nreact-native-keychain\nreact-native-secure-storage\nExpo\u2019s secure store")),Object(o.b)("p",null,"This means that the authentication data is stored in an unencrypted form, and this is a risk\n\ud83d\udd77 of information security with possible negative consequences \ud83d\udd78. "),Object(o.b)("p",null,"Source code for this part is available on ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/react-native-village/aws-amplify-react-hooks/tree/master/examples/reactNativeCRUDv2"}),"GitHub"),"."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/01.png",alt:"cognito"}))),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/01.png",alt:"Step01"}))),Object(o.b)("h2",{id:"ui-kit"},"UI Kit"),Object(o.b)("p",null,"We will use our UI Kit, but you're free to use your own or others."),Object(o.b)("p",null,"We connect the component library according to ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://react-native-village.github.io/docs/unicorn00"}),"this")," article."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/02.png",alt:"Step02"}))),Object(o.b)("h2",{id:"add-navigation"},"Add navigation"),Object(o.b)("p",null,"install react-navigation v5, based on this instruction ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://reactnavigation.org/docs/getting-started/"}),"here"),"\n(at the time of  writing this article this is latest version of navigation) "),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"yarn add react-native-reanimated react-native-gesture-handler react-native-screens react-native-safe-area-context @react-native-community/masked-view @react-navigation/stack\n")),Object(o.b)("p",null,"Add pods for iOS"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"cd ios && pod install && cd ..\n")),Object(o.b)("div",{class:"alert alert--info",role:"alert"},"\ud83d\udccc I recommend to launch the application for iOS and Android, after each installation, in order to avoid searching for the library because of which the application crashes."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/03.png",alt:"Step03"}))),Object(o.b)("h2",{id:"react-native-keychain"},"react-native-keychain"),Object(o.b)("p",null,"Add react-native-keychain - this is a secure keystore library for React Native."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"yarn add react-native-keychain\n")),Object(o.b)("p",null,"Add pods for iOS"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-bash"}),"cd ios && pod install && cd ..\n")),Object(o.b)("p",null,"According to ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://aws-amplify.github.io/docs/js/authentication#managing-security-tokens"}),"official documentation:")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"When using authentication with AWS Amplify, you don\u2019t have to update Amazon Cognito tokens manually. Tokens are automatically updated by the library when necessary. Security tokens, such as IdToken or AccessToken, are stored in localStorage for the browser and in AsyncStorage for React Native. If you want to store these tokens in a more secure place or use Amplify on the server side, you can provide your own storage object for storing these tokens.")),Object(o.b)("p",null,"configure src / index.js"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React from 'react'\nimport Amplify from '@aws-amplify/core'\nimport * as Keychain from 'react-native-keychain'\nimport { ThemeProvider, DarkTheme, LightTheme } from 'react-native-unicorn-uikit'\nimport { useColorScheme } from 'react-native-appearance'\nimport AppNavigator from './AppNavigator'\nimport awsconfig from '../aws-exports'\n\nconst MEMORY_KEY_PREFIX = '@MyStorage:'\nlet dataMemory = {}\n\nclass MyStorage {\n  static syncPromise = null\n\n  static setItem(key, value) {\n    Keychain.setGenericPassword(MEMORY_KEY_PREFIX + key, value)\n    dataMemory[key] = value\n    return dataMemory[key]\n  }\n\n  static getItem(key) {\n    return Object.prototype.hasOwnProperty.call(dataMemory, key) ? dataMemory[key] : undefined\n  }\n\n  static removeItem(key) {\n    Keychain.resetGenericPassword()\n    return delete dataMemory[key]\n  }\n\n  static clear() {\n    dataMemory = {}\n    return dataMemory\n  }\n}\n\nAmplify.configure({\n  ...awsconfig,\n  Analytics: {\n    disabled: false\n  },\n  storage: MyStorage\n})\n\nconst App = () => {\n  const scheme = useColorScheme()\n  return (\n    <>\n      <ThemeProvider theme={scheme === 'dark' ? DarkTheme : LightTheme}>\n        <AppNavigator />\n      </ThemeProvider>\n    </>\n  )\n}\n\nexport default App\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/04.png",alt:"Step04"}))),Object(o.b)("h2",{id:"constants"},"Constants"),Object(o.b)("p",null,"Create a file with constants for general use in\nsrc / constants.js components. This is helps us to avoid copy pasting the same values multiple times"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import { Dimensions } from 'react-native'\n\nexport const BG = '#0B0B0B'\nexport const PINK = '#F20AF5'\nexport const PURPLE = '#7A1374'\nexport const BLUE = '#00FFFF'\nexport const GREEN = '#2E7767'\nexport const RED = '#FC2847'\nexport const LABEL_COLOR = BLUE\nexport const INPUT_COLOR = PINK\nexport const ERROR_COLOR = RED\nexport const HELP_COLOR = '#999999'\nexport const BORDER_COLOR = BLUE\nexport const DISABLED_COLOR = '#777777'\nexport const DISABLED_BACKGROUND_COLOR = '#eeeeee'\n\nexport const win = Dimensions.get('window')\nexport const W = win.width\nexport const H = win.height\n\nexport const Device = {\n  // eslint-disable-next-line\n  select(variants) {\n    if (W >= 300 && W <= 314) return variants.mobile300 || {}\n    if (W >= 315 && W <= 341) return variants.iphone5 || {}\n    if (W >= 342 && W <= 359) return variants.mobile342 || {}\n    if (W >= 360 && W <= 374) return variants.mi5 || {}\n    if (W >= 375 && W <= 399) return variants.iphone678 || {}\n    if (W >= 400 && W <= 409) return variants.mobile400 || {}\n    if (W >= 410 && W <= 414) return variants.googlePixel || {}\n    if (W >= 415 && W <= 434) return variants.mobile415 || {}\n    if (W >= 435 && W <= 480) return variants.redmiNote5 || {}\n  }\n}\n\nexport const goBack = navigation => () => navigation.goBack()\n\nexport const onScreen = (screen, navigation, obj) => () => {\n  navigation.navigate(screen, obj)\n}\n\nexport const goHome = navigation => () => navigation.popToTop()()\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/05.png",alt:"Step05"}))),Object(o.b)("h2",{id:"appnavigator"},"AppNavigator"),Object(o.b)("p",null,"Create a navigation configuration file for our custom authentication src / AppNavigator.js"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import * as React from 'react'\nimport { createStackNavigator } from '@react-navigation/stack'\nimport { Hello } from './screens/Authenticator'\n\nconst Stack = createStackNavigator()\n\nconst AppNavigator = () => {   \n  return (\n    <Stack.Navigator\n      screenOptions={{\n        headerShown: false\n      }}\n      initialRouteName=\"HELLO\"\n    >\n      <Stack.Screen name=\"HELLO\" component={Hello} />\n    </Stack.Navigator>\n  )\n}\n\nexport default AppNavigator\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/06.png",alt:"Step06"}))),Object(o.b)("h2",{id:"hello-screen"},"Hello screen"),Object(o.b)("p",null,"Create an entry point for our authentication screens src/screens/Authenticator/index.js "),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-04.png",alt:"Hello screen"}))),Object(o.b)("p",null,"To begin with, let's connect welcome screen"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"export * from './Hello'\n")),Object(o.b)("p",null,"After we create it src/screens/Authenticator/Hello/index.js"),Object(o.b)("p",null,"In the useEffect hook, we check for a user token, where in the case of true we go to the User screen, and in the case of false, we remain on this screen."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useEffect, useState } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { AppContainer, Button, Space, H6 } from 'react-native-unicorn-uikit'\nimport { onScreen } from '../../../constants'\n\nconst Hello = ({ navigation }) => {\n  const [loading, setLoading] = useState(false)\n  useEffect(() => {\n    setLoading(true)\n    const key = async () => {\n      try {\n        const credentials = await Keychain.getInternetCredentials('auth')\n\n        if (credentials) {\n          const { username, password } = credentials\n          const user = await Auth.signIn(username, password)\n          setLoading(false)\n          user && onScreen('USER', navigation)()\n        } else {\n          setLoading(false)\n        }\n      } catch (err) {\n        console.log('error', err) // eslint-disable-line\n        setLoading(false)\n      }\n    }\n    key()\n  }, []) // eslint-disable-line\n  return (\n    <AppContainer loading={loading}>\n      <Space height={200} />\n      <Button title=\"Sign In\" onPress={onScreen('SIGN_IN', navigation)} />\n      <Space height={10} />\n      <H6 title=\"or\" textStyle={{ alignSelf: 'center' }} />\n      <Space height={15} />\n      <Button title=\"Sign Up\" onPress={onScreen('SIGN_UP', navigation)} />\n    </AppContainer>\n  )\n}\n\nexport { Hello }\n")),Object(o.b)("p",null,"Put together all changes and meet the welcome screen."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/07.png",alt:"Step07"}))),Object(o.b)("h2",{id:"signup-screen"},"SignUp screen"),Object(o.b)("p",null,"We create the registration screen SIGN_UP src/screens/Authenticator/SignUp/index.js, where for authentication we use the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://aws-amplify.github.io/docs/js/authentication#sign-up"}),"Auth.signUp")," method."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-05.png",alt:"SignUp"}))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { AppContainer, Space, Button, Input, TextError } from 'react-native-unicorn-uikit'\nimport { onScreen, goBack } from '../../../constants'\n\nconst SignUp = ({ navigation }) => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values) => {\n    const { email, password, passwordConfirmation } = values\n    if (password !== passwordConfirmation) {\n      setError('Passwords do not match!')\n    } else {\n      setLoading(true)\n      setError('')\n      try {\n        const user = await Auth.signUp(email, password)\n        await Keychain.setInternetCredentials('auth', email, password)\n        user && onScreen('CONFIRM_SIGN_UP', navigation, { email, password })()\n        setLoading(false)\n      } catch (err) {\n        setLoading(false)\n        if (err.code === 'UserNotConfirmedException') {\n          setError('Account not verified yet')\n        } else if (err.code === 'PasswordResetRequiredException') {\n          setError('Existing user found. Please reset your password')\n        } else if (err.code === 'NotAuthorizedException') {\n          setError('Forgot Password?')\n        } else if (err.code === 'UserNotFoundException') {\n          setError('User does not exist!')\n        } else {\n          setError(err.code)\n        }\n      }\n    }\n  }\n\n  return (\n    <>\n      <AppContainer onPress={goBack(navigation)} title=\"Sign Up\" loading={loading}>\n        <Space height={80} />\n        <Formik\n          initialValues={{ email: '', password: '', passwordConfirmation: '' }}\n          onSubmit={(values) => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string().email().required(),\n            password: Yup.string().min(6).required(),\n            passwordConfirmation: Yup.string().min(6).required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, isValid, handleSubmit }) => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={() => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Input\n                name=\"password\"\n                value={values.password}\n                onChangeText={handleChange('password')}\n                onBlur={() => setFieldTouched('password')}\n                placeholder=\"Password\"\n                touched={touched}\n                errors={errors}\n                secureTextEntry\n              />\n              <Input\n                name=\"passwordConfirmation\"\n                value={values.passwordConfirmation}\n                onChangeText={handleChange('passwordConfirmation')}\n                onBlur={() => setFieldTouched('passwordConfirmation')}\n                placeholder=\"Password confirm\"\n                touched={touched}\n                errors={errors}\n                secureTextEntry\n              />\n              <Space height={30} />\n              {error !== '' && <TextError title={error} textStyle={{ alignSelf: 'center' }} />}\n              <Button title=\"Sign Up\" disabled={!isValid} onPress={handleSubmit} formik />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { SignUp }\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/08.png",alt:"Step08"}))),Object(o.b)("h2",{id:"confirmsignup-screen"},"ConfirmSignUp screen"),Object(o.b)("p",null,"After a successful response from the server, we go to the confirmation screen and enter the code that came to our mail. To do this, create the screen CONFIRM_SIGN_UP src/screens/Authenticator/ConfirmSignUp/index.js"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-06.png",alt:"ConfirmSignUp"}))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react'\nimport { Auth } from 'aws-amplify'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { AppContainer, Button, Space, ButtonLink, TextError, Input } from 'react-native-unicorn-uikit'\nimport { onScreen, goBack } from '../../../constants'\n\nconst ConfirmSignUp = ({ route, navigation }) => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values) => {\n    setLoading(true)\n    setError('')\n    try {\n      const { code } = values\n      const { email, password } = route.params\n      await Auth.confirmSignUp(email, code, { forceAliasCreation: true })\n      const user = await Auth.signIn(email, password)\n      user && onScreen('USER', navigation)()\n      setLoading(false)\n    } catch (err) {\n      setLoading(false)\n      setError(err.message)\n      if (err.code === 'UserNotConfirmedException') {\n        setError('Account not verified yet')\n      } else if (err.code === 'PasswordResetRequiredException') {\n        setError('Existing user found. Please reset your password')\n      } else if (err.code === 'NotAuthorizedException') {\n        setError('Forgot Password?')\n      } else if (err.code === 'UserNotFoundException') {\n        setError('User does not exist!')\n      }\n    }\n  }\n\n  const _onResend = async () => {\n    try {\n      const { email } = route.params\n      await Auth.resendSignUp(email)\n    } catch (err) {\n      setError(err.message)\n    }\n  }\n\n  return (\n    <>\n      <AppContainer title=\"Confirmation\" onPress={goBack(navigation)} loading={loading}>\n        <Formik\n          initialValues={{ code: '' }}\n          onSubmit={(values) => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            code: Yup.string().min(6).required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, isValid, handleSubmit }) => (\n            <>\n              <Space height={180} />\n              <Input\n                name=\"code\"\n                value={values.code}\n                onChangeText={handleChange('code')}\n                onBlur={() => setFieldTouched('code')}\n                placeholder=\"Insert code\"\n                touched={touched}\n                errors={errors}\n              />\n              <ButtonLink title=\"Resend code?\" onPress={_onResend} textStyle={{ alignSelf: 'center' }} />\n              {error !== 'Forgot Password?' && <TextError title={error} />}\n              <Button title=\"Confirm\" disabled={!isValid} onPress={handleSubmit} formik />\n              <Space height={50} />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { ConfirmSignUp }\n")),Object(o.b)("h2",{id:"resendsignup"},"ResendSignUp"),Object(o.b)("p",null,"If the code has not arrived, then we must provide the user with the opportunity to resend the code.\nTo do this, we put Auth.resendSignUp(userInfo.email)  on button  Resend code.\nIn case of a successful method call"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"Auth.confirmSignUp(email, code, { forceAliasCreation: true })\n")),Object(o.b)("p",null,"we must call the method"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"Auth.signIn(email, password)\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/09.png",alt:"Step09"}))),Object(o.b)("h2",{id:"user-screen"},"User screen"),Object(o.b)("p",null,"Once it successfully done, go to the USER screen, which we create with the exit button for the application and clearing the src/screens/Authenticator/User/index.js tokens"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-07.png",alt:"User screen"}))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState, useEffect } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { AppContainer, Button } from 'react-native-unicorn-uikit'\nimport { goHome } from '../../../constants'\n\nconst User = ({ navigation }) => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    const checkUser = async () => {\n      await Auth.currentAuthenticatedUser()\n    }\n    checkUser()\n  })\n\n  const _onPress = async () => {\n    setLoading(true)\n    try {\n      await Auth.signOut()\n      await Keychain.resetInternetCredentials('auth')\n      goHome(navigation)()\n    } catch (err) {\n      setError(err.message)\n    }\n  }\n\n  return (\n    <AppContainer message={error} loading={loading}>\n      <Button title=\"Sign Out\" onPress={_onPress} />\n    </AppContainer>\n  )\n}\n\nexport { User }\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/10.png",alt:"Step10"}))),Object(o.b)("h2",{id:"signin-screen"},"SignIn screen"),Object(o.b)("p",null,"After the user is registered, we must provide the user with the opportunity to enter the application through login and password. To do this, we create the SIGN_IN src/screens/Authenticator/SignIn/index.js screen"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-08.png",alt:"SignIn screen"}))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { AppContainer, Button, Space, ButtonLink, TextError, Input } from 'react-native-unicorn-uikit'\nimport { onScreen, goBack } from '../../../constants'\n\nconst SignIn = ({ navigation }) => {\n  const [userInfo, setUserInfo] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values) => {\n    setLoading(true)\n    setError('')\n    try {\n      const { email, password } = values\n      const user = await Auth.signIn(email, password)\n      await Keychain.setInternetCredentials('auth', email, password)\n      user && onScreen('USER', navigation)()\n      setLoading(false)\n    } catch (err) {\n      setLoading(false)\n      if (err.code === 'UserNotConfirmedException') {\n        setError('Account not verified yet')\n      } else if (err.code === 'PasswordResetRequiredException') {\n        setError('Existing user found. Please reset your password')\n      } else if (err.code === 'NotAuthorizedException') {\n        setError('Forgot Password?')\n      } else if (err.code === 'UserNotFoundException') {\n        setError('User does not exist!')\n      } else {\n        setError(err.code)\n      }\n    }\n  }\n\n  return (\n    <>\n      <AppContainer onPress={goBack(navigation)} title=\"Sign In\" loading={loading}>\n        <Space height={140} />\n        <Formik\n          initialValues={{ email: '', password: '' }}\n          onSubmit={(values) => _onPress(values) && setUserInfo(values.email)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string().email().required(),\n            password: Yup.string().min(6).required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, isValid, handleSubmit }) => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={() => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Input\n                name=\"password\"\n                value={values.password}\n                onChangeText={handleChange('password')}\n                onBlur={() => setFieldTouched('password')}\n                placeholder=\"Password\"\n                touched={touched}\n                errors={errors}\n                secureTextEntry\n              />\n              {error !== 'Forgot Password?' && <TextError title={error} textStyle={{ alignSelf: 'center' }} />}\n              {error === 'Forgot Password?' && (\n                <ButtonLink\n                  title={error}\n                  onPress={onScreen('FORGOT', navigation, userInfo)}\n                  textStyle={{ alignSelf: 'center' }}\n                />\n              )}\n              <Space height={30} />\n              <Button title=\"Sign In\" disabled={!isValid} onPress={handleSubmit} formik />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { SignIn }\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/11.png",alt:"Step11"}))),Object(o.b)("h2",{id:"forgot-password-screen"},"Forgot password screen"),Object(o.b)("p",null,"If successful, we send the user to the USER screen, which we have already done, and if the user has forgotten or entered the password incorrectly, then we show the Forgot Password error and suggest resetting the password."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-09.png",alt:"Forgot password"}))),Object(o.b)("p",null,"To do this, we create the FORGOT src/screens/Authenticator/Forgot/index.js screen"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-10.png",alt:"Forgot password"}))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react'\nimport { Auth } from 'aws-amplify'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { AppContainer, Button, Input } from 'react-native-unicorn-uikit'\nimport { onScreen, goBack } from '../../../constants'\n\nconst Forgot = ({ route, navigation }) => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values) => {\n    setLoading(true)\n    try {\n      const { email } = values\n      const user = await Auth.forgotPassword(email)\n      user && onScreen('FORGOT_PASSWORD_SUBMIT', navigation, email)()\n      setLoading(false)\n    } catch (err) {\n      setError(error)\n    }\n  }\n\n  return (\n    <>\n      <AppContainer title=\"Forgot\" onPress={goBack(navigation)} loading={loading}>\n        <Formik\n          initialValues={{ email: route.params }}\n          onSubmit={(values) => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string().email().required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, isValid, handleSubmit }) => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={() => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Button title=\"Confirm\" disabled={!isValid} onPress={handleSubmit} formik />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { Forgot }\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/12.png",alt:"Step12"}))),Object(o.b)("h2",{id:"forgot-password-submit"},"Forgot Password Submit"),Object(o.b)("p",null,"After confirming the e-mail, we call the Auth.forgotPassword (email) method and if there is such a user, we send the user to the FORGOT_PASSWORD_SUBMIT src/screens/Authenticator/ForgotPassSubmit/index.js screen"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/auth/auth1-11.png",alt:"ForgotPassSubmit"}))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"import React, { useState } from 'react'\nimport { Platform } from 'react-native'\nimport { Auth } from 'aws-amplify'\nimport * as Keychain from 'react-native-keychain'\nimport { Formik } from 'formik'\nimport * as Yup from 'yup'\nimport { AppContainer, Button, Space, Input, TextError } from 'react-native-unicorn-uikit'\nimport { onScreen, goBack } from '../../../constants'\n\nconst ForgotPassSubmit = ({ route, navigation }) => {\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState('')\n\n  const _onPress = async (values) => {\n    setLoading(true)\n    try {\n      const { email, code, password } = values\n      await Auth.forgotPasswordSubmit(email, code, password)\n      await Keychain.setInternetCredentials('auth', email, password)\n      onScreen('USER', navigation)()\n      setLoading(false)\n    } catch (err) {\n      setLoading(false)\n      setError(err.message)\n    }\n  }\n\n  return (\n    <>\n      <AppContainer title=\"Confirmation\" onPress={goBack(navigation)} loading={loading}>\n        <Space height={Platform.OS === 'ios' ? 20 : 150} />\n        <Formik\n          initialValues={{ email: route.params, code: '', password: '', passwordConfirmation: '' }}\n          onSubmit={(values) => _onPress(values)}\n          validationSchema={Yup.object().shape({\n            email: Yup.string().email().required(),\n            code: Yup.string().min(6).required(),\n            password: Yup.string().min(6).required(),\n            passwordConfirmation: Yup.string().min(6).required()\n          })}\n        >\n          {({ values, handleChange, errors, setFieldTouched, touched, isValid, handleSubmit }) => (\n            <>\n              <Input\n                name=\"email\"\n                value={values.email}\n                onChangeText={handleChange('email')}\n                onBlur={() => setFieldTouched('email')}\n                placeholder=\"E-mail\"\n                touched={touched}\n                errors={errors}\n                autoCapitalize=\"none\"\n              />\n              <Input\n                name=\"code\"\n                value={values.code}\n                onChangeText={handleChange('code')}\n                onBlur={() => setFieldTouched('code')}\n                placeholder=\"Code\"\n                touched={touched}\n                errors={errors}\n              />\n              <Input\n                name=\"password\"\n                value={values.password}\n                onChangeText={handleChange('password')}\n                onBlur={() => setFieldTouched('password')}\n                placeholder=\"Password\"\n                touched={touched}\n                errors={errors}\n                secureTextEntry\n              />\n              <Input\n                name=\"passwordConfirmation\"\n                value={values.passwordConfirmation}\n                onChangeText={handleChange('passwordConfirmation')}\n                onBlur={() => setFieldTouched('passwordConfirmation')}\n                placeholder=\"Password confirm\"\n                touched={touched}\n                errors={errors}\n                secureTextEntry\n              />\n              {error !== '' && <TextError title={error} textStyle={{ alignSelf: 'center' }} />}\n              <Space height={30} />\n              <Button title=\"Confirm\" disabled={!isValid} onPress={handleSubmit} formik />\n            </>\n          )}\n        </Formik>\n      </AppContainer>\n    </>\n  )\n}\n\nexport { ForgotPassSubmit }\n")),Object(o.b)("p",null,"where, after entering the code sent to the mail, the new password and confirming it, we call the password change method"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"Auth.forgotPasswordSubmit(email, code, password)\n")),Object(o.b)("p",null,"whose success sends the user to the USER screen."),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/13.png",alt:"Step13"}))),Object(o.b)("h2",{id:"linking-screens"},"Linking screens"),Object(o.b)("p",null,"We connect all created components in src/screens/Authenticator/index.js"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"export * from './Hello'\nexport * from './User'\nexport * from './SignIn'\nexport * from './SignUp'\nexport * from './Forgot'\nexport * from './ForgotPassSubmit'\nexport * from './ConfirmSignUp'\n")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/14.png",alt:"Step14"}))),Object(o.b)("h2",{id:"udpate-appnavigator"},"Udpate AppNavigator"),Object(o.b)("p",null,"Updating the navigation configuration file:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),'import * as React from \'react\'\nimport { createStackNavigator } from \'@react-navigation/stack\'\nimport { Hello, SignUp, SignIn, ConfirmSignUp, User, Forgot, ForgotPassSubmit } from \'./screens/Authenticator\'\n\nconst Stack = createStackNavigator()\n\nconst AppNavigator = () => {\n  return (\n    <Stack.Navigator\n      screenOptions={{\n        headerShown: false\n      }}\n      initialRouteName="HELLO"\n    >\n      <Stack.Screen name="HELLO" component={Hello} />\n      <Stack.Screen name="SIGN_UP" component={SignUp} />\n      <Stack.Screen name="SIGN_IN" component={SignIn} />\n      <Stack.Screen name="FORGOT" component={Forgot} />\n      <Stack.Screen name="FORGOT_PASSWORD_SUBMIT" component={ForgotPassSubmit} />\n      <Stack.Screen name="CONFIRM_SIGN_UP" component={ConfirmSignUp} />\n      <Stack.Screen name="USER" component={User} />\n    </Stack.Navigator>\n  )\n}\n\nexport default AppNavigator\n')),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/15.png",alt:"Step15"}))),Object(o.b)("h2",{id:"clean-up"},"Clean Up"),Object(o.b)("p",null,"Since we use a custom theme, we remove the components AmplifyTheme and Localei18n"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"/img/steps/16.png",alt:"Step16"}))),Object(o.b)("h2",{id:"debug"},"Debug"),Object(o.b)("p",null,"In order to understand what happens with tokens in your application, add in the root/index.js"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-jsx"}),"window.LOG_LEVEL = 'DEBUG'\n")),Object(o.b)("p",null,"We launch the application and get custom authentication."),Object(o.b)("h2",{id:"done-"},"Done \u2705"),Object(o.b)("p",null,Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.patreon.com/bePatron?u=34467235"}),Object(o.b)("img",Object(r.a)({parentName:"a"},{src:"/img/logo/patreon.png",alt:"Become a Patron!"})))))}p.isMDXComponent=!0},174:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return g}));var r=t(0),a=t.n(r);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),p=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s({},n,{},e)),t},u=function(e){var n=p(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},m=Object(r.forwardRef)((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(t),m=r,g=u["".concat(i,".").concat(m)]||u[m]||d[m]||o;return t?a.a.createElement(g,s({ref:n},l,{components:t})):a.a.createElement(g,s({ref:n},l))}));function g(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);